# ğŸ’» Routeur

## â€‹ğŸ§­â€‹ Sommaire

- [ğŸ’» Routeur](#-routeur)
  - [â€‹ğŸ§­â€‹ Sommaire](#-sommaire)
  - [ğŸ“–â€‹ Description](#-description)
  - [ğŸ› ï¸â€‹ Installation](#ï¸-installation)
  - [ğŸš¦Utilisation](#utilisation)
    - [ğŸ  ExÃ©cution directe](#-exÃ©cution-directe)
      - [Cheatsheet](#cheatsheet)
    - [ğŸ³ ExÃ©cution via Docker](#-exÃ©cution-via-docker)
      - [Cheatsheet](#cheatsheet-1)
        - [*Construire l'image Docker*](#construire-limage-docker)
        - [*Lancer le conteneur Docker*](#lancer-le-conteneur-docker)
        - [*VÃ©rifier que le conteneur fonctionne*](#vÃ©rifier-que-le-conteneur-fonctionne)
        - [*AccÃ©der Ã  l'application*](#accÃ©der-Ã -lapplication)
        - [*Ouvrir un terminal dans le conteneur*](#ouvrir-un-terminal-dans-le-conteneur)
        - [*Suppression du conteneur*](#suppression-du-conteneur)
        - [*Suppression/build/dÃ©marrage de l'image en mode troubleshooting*](#suppressionbuilddÃ©marrage-de-limage-en-mode-troubleshooting)
        - [*Suppression/build/dÃ©marrage de l'image en mode production*](#suppressionbuilddÃ©marrage-de-limage-en-mode-production)

## ğŸ“–â€‹ Description

## ğŸ› ï¸â€‹ Installation

## ğŸš¦Utilisation

### ğŸ  ExÃ©cution directe

*ğŸ“VÃ©rifiez que vous Ãªtes bien dans le rÃ©pertoire `clioserv/` du projet avant d'exÃ©cuter vos commandes.*
â€‹
*âš ï¸Le serveur ne fonctionnera pas sur Windows en utilisant le port 80 (le port par dÃ©faut), il faut utiliser un autre port (par exemple 8080) ou exÃ©cuter Docker en mode administrateur.*

*Compiler l'application en mode hÃ´te* 
```bash
gcc router/src/main.c common/dependencies/mongoose/mongoose.c -o exploitation/clioserv-router.exe -I common/dependencies/mongoose
```

*Flash clean/compile&run*
```bash
rm -f exploitation/clioserv-router.exe && clear && gcc router/src/main.c common/dependencies/mongoose/mongoose.c common/src/utils/utils.c -o exploitation/clioserv-router.exe -I common/dependencies/mongoose -I common/src/utils && ./exploitation/clioserv-router.exe
```

Si compilation sur MSYS 2 :
1. Lancer avec commande `C:\msys64\msys2_shell.cmd -mingw64 -here -no-start`
2. Puis compiler comme indiquÃ© plus haut en ajoutant l'option -lws2_32

*Lancer le serveur en mode hÃ´te (port d'Ã©coute par dÃ©faut : 8080)*
```bash
./exploitation/clioserv-router.exe
```

#### Cheatsheet



### ğŸ³ ExÃ©cution via Docker

#### Cheatsheet

*ğŸ“Si vous dÃ©ployez l'application en environnement de production, assurez-vous que le routage des ports ait Ã©tÃ© fait.*
*ğŸ“Si vous Ãªtes sur Windows, assurez-vous que Docker Engine fonctionne.*
*ğŸ“VÃ©rifiez que vous Ãªtes bien dans le rÃ©pertoire `clioserv/router/` du projet avant d'exÃ©cuter vos commandes.*

| Commandes | Description |
|-----------|-------------|
| `docker build -t clioserv_router .` | Construire l'image Docker |
| `docker run -d -p <port_d'Ã©coute_hÃ´te>:<port_d'Ã©coute_conteneur> --name clioserv_router clioserv_router` | Lancer le conteneur Docker |
| `docker ps` | VÃ©rifier que le conteneur fonctionne |
| `docker exec -it clioserv_router /bin/bash` | Ouvrir un terminal dans le conteneur |
| `docker rm -f clioserv_router` | Suppression du conteneur |
| `docker rm -f clioserv_router ; docker build -t clioserv_router . ; docker run -it -p 8080:80 --name clioserv_router clioserv_router` | Suppression/build/dÃ©marrage de l'image en mode troubleshooting |
| `docker rm -f clioserv_router ; docker build -t clioserv_router . ; docker run -d -p 8080:80 --name clioserv_router clioserv_router` | Suppression/build/dÃ©marrage de l'image en mode production |

##### *Construire l'image Docker*
```bash
docker build -t clioserv_router .
```

##### *Lancer le conteneur Docker*
```bash
docker run -d -p <port_d'Ã©coute_hÃ´te>:<port_d'Ã©coute_conteneur> --name clioserv_router clioserv_router
```

##### *VÃ©rifier que le conteneur fonctionne*
```bash
docker ps
```

##### *AccÃ©der Ã  l'application*
Ouvrir un navigateur et aller Ã  l'adresse suivante : [http://localhost:8080](http://localhost:8080)
*ArrÃªter le conteneur*

##### *Ouvrir un terminal dans le conteneur*
```bash
docker exec -it clioserv_router /bin/bash
```

##### *Suppression du conteneur*
```bash
docker rm -f clioserv_router
```

##### *Suppression/build/dÃ©marrage de l'image en mode troubleshooting*
```bash
docker rm -f clioserv_router ; docker build -t clioserv_router . ; docker run -it -p 8080:80 --name clioserv_router clioserv_router
```

##### *Suppression/build/dÃ©marrage de l'image en mode production*
```bash
docker rm -f clioserv_router ; docker build -t clioserv_router . ; docker run -d -p 8080:80 --name clioserv_router clioserv_router
```